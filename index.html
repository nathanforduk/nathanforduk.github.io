<!DOCTYPE html>
<html>
    <head>
        <meta name = viewport content = "width=device-width,initial-scale=1">
        <meta name = description content = "Paintings by Nathan Ford">

        <script async src = "//www.googletagmanager.com/gtag/js?id=G-LD4L8FCK6D"></script>
        <script src = js/main.js></script>

        <link rel = stylesheet href = css/main.css>

        <style>
            body {
                overflow: hidden;
                background-color: #999
            }

            div {
                position: fixed;
                font-family: elite;
                font-size: 40px;
                background-color: #fff8;
                border-top-right-radius: .3em;
                border-bottom-right-radius: .3em;
                padding: .8em;
                color: #000;
                top: 1em;
                left: 0
            }
        </style>

        <title>Nathan Ford</title>
    </head>

    <body>
        <a href = works>
            <div>nathanford.co.uk</div>
            <canvas></canvas>
        </a>
        
        <script>
            const FRAME = 480
            const FADE = 180

            devicePixelRatio = 2

            const canvas = document.querySelector("canvas")
            const ctx = canvas.getContext("2d")
            const pixel = devicePixelRatio

            const images = ["slider_1.jpg", "slider_2.jpg", "slider_3.jpg", "slider_4.jpg"]
            const slider = {start: true, index: 0, timer: -FADE / 2}

            function start() {
                images.forEach((name, i) => {
                    images[i] = new Image()
                    images[i].src = "assets/images/" + name
                })

                onresize()
                loop()
            }

            function loop() {
                ctx.clearRect(0, 0, canvas.width / pixel, canvas.height / pixel)

                const draw = (index, fade) => {
                    ctx.globalAlpha = fade

                    const width = canvas.width / pixel / images[index].width
                    const height = canvas.height / pixel / images[index].height
                    const scale = width > height ? width : height

                    ctx.drawImage(
                        images[index],
                        ~~(canvas.width / pixel / 2 - images[index].width * scale / 2),
                        ~~(canvas.height / pixel / 2 - images[index].height * scale / 2),
                        ~~(images[index].width * scale), ~~(images[index].height * scale))
                }

                slider.timer ++

                if (slider.timer == FRAME + FADE) {
                    slider.index = slider.index + 1 == images.length ? 0 : slider.index + 1
                    slider.start = false
                    slider.timer = 0
                }

                if (slider.timer < FADE / 2) {
                    const previous = slider.index - 1
                    const fade = (slider.timer + FADE / 2) / FADE

                    slider.start || draw(previous < 0 ? images.length - 1 : previous, 1 - fade)
                    draw(slider.index, fade)
                }

                else if (slider.timer < FRAME + FADE / 2)
                    draw(slider.index, (slider.timer + FADE / 2) / FADE)

                else {
                    const next = slider.index + 1
                    const fade = (FRAME + FADE - (slider.timer - FADE / 2)) / FADE

                    draw(slider.index, fade)
                    draw(next == images.length ? 0 : next, 1 - fade)
                }

                requestAnimationFrame(loop)
            }

            onresize = () => {
                canvas.width = innerWidth * pixel
                canvas.height = innerHeight * pixel

                ctx.scale(pixel, pixel)
            }

            start()
        </script>
    </body>
</html>
